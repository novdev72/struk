<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Struk Konsultasi TikTok - Versi Premium</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #ff0050;
      --secondary: #00f2ea;
      --accent: #69c9d0;
      --dark: #121212;
      --light: #f8f9fa;
      --gray: #6c757d;
      --success: #28a745;
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      color: #333;
    }
    
    .header {
      text-align: center;
      margin-bottom: 20px;
      width: 100%;
      max-width: 500px;
    }
    
    .header h1 {
      color: var(--dark);
      margin-bottom: 5px;
      font-size: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .header p {
      color: var(--gray);
      font-size: 14px;
    }
    
    .form-container {
      background: white;
      padding: 24px;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 500px;
      margin-bottom: 24px;
      border-top: 5px solid var(--primary);
    }
    
    .form-container h3 {
      margin-top: 0;
      color: var(--dark);
      text-align: center;
      font-size: 22px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .form-container h3 i {
      color: var(--primary);
    }
    
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-container label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: var(--dark);
      font-size: 14px;
    }
    
    .form-container input, .form-container textarea, .form-container select {
      width: 100%;
      padding: 12px;
      margin: 4px 0;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-family: inherit;
      resize: vertical;
      transition: all 0.3s;
      font-size: 15px;
    }
    
    .form-container input:focus, .form-container textarea:focus, .form-container select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(105, 201, 208, 0.2);
    }
    
    .form-container textarea { 
      min-height: 80px; 
    }
    
    .score-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin: 16px 0;
    }
    
    .score-item {
      display: flex;
      flex-direction: column;
    }
    
    .score-label {
      font-weight: 500;
      font-size: 14px;
      margin-bottom: 6px;
    }
    
    .score-input {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .score-input input {
      flex: 1;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ddd;
      text-align: center;
      font-weight: bold;
    }
    
    .score-max {
      color: var(--gray);
      font-size: 14px;
    }
    
    .buttons {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }
    
    button {
      flex: 1;
      padding: 14px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 15px;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-generate {
      background: var(--primary);
      color: white;
    }
    
    .btn-generate:hover {
      background: #e00046;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 0, 80, 0.3);
    }
    
    .btn-download {
      background: var(--secondary);
      color: var(--dark);
    }
    
    .btn-download:hover {
      background: #00d9d2;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 242, 234, 0.3);
    }

    /* Receipt style (1080px wide) */
    .receipt {
      background: white;
      width: 1080px;
      min-height: 1080px;
      padding: 40px 50px;
      box-sizing: border-box;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      font-size: 22px;
      line-height: 1.4;
      color: #111;
      position: relative;
      overflow: hidden;
    }
    
    .receipt::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 8px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
    }
    
    .receipt h2 {
      text-align: center;
      margin-bottom: 20px;
      padding-bottom: 12px;
      font-size: 32px;
      color: var(--dark);
      position: relative;
    }
    
    .receipt h2::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 20%;
      right: 20%;
      height: 3px;
      background: linear-gradient(90deg, transparent, var(--accent), transparent);
    }
    
    .section { 
      margin-bottom: 20px; 
    }
    
    .label { 
      font-weight: bold; 
      display: block; 
      margin-bottom: 6px; 
      font-size: 20px; 
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .label i {
      font-size: 18px;
    }
    
    hr { 
      border: none; 
      border-top: 2px dashed #ddd; 
      margin: 20px 0; 
    }
    
    .score-display {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 10px;
    }
    
    .score-box {
      padding: 12px;
      border-radius: 10px;
      background: #f8f9fa;
      text-align: center;
    }
    
    .score-title {
      font-size: 16px;
      margin-bottom: 8px;
      color: var(--gray);
    }
    
    .score-value {
      font-size: 24px;
      font-weight: bold;
      color: var(--primary);
    }
    
    .score-bar {
      height: 10px;
      background: #e9ecef;
      border-radius: 5px;
      margin-top: 8px;
      overflow: hidden;
    }
    
    .score-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      border-radius: 5px;
    }
    
    .account-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 10px;
    }
    
    .info-box {
      padding: 12px;
      border-radius: 10px;
      background: #f8f9fa;
    }
    
    .info-title {
      font-size: 16px;
      margin-bottom: 8px;
      color: var(--gray);
    }
    
    .info-value {
      font-size: 20px;
      font-weight: bold;
      color: var(--dark);
    }
    
    .preserve {
      white-space: pre-wrap;
      word-break: break-word;
      font-family: inherit;
      font-size: 20px;
      line-height: 1.5;
      padding: 8px 0;
    }
    
    .highlight-box {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      padding: 16px;
      border-radius: 10px;
      border-left: 4px solid var(--accent);
      margin: 16px 0;
    }
    
    .potential-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
      margin: 15px 0;
    }
    
    .potential-item {
      padding: 12px;
      border-radius: 8px;
      background: white;
      border-left: 4px solid var(--success);
    }
    
    .potential-title {
      font-weight: bold;
      margin-bottom: 6px;
      color: var(--dark);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .potential-title i {
      color: var(--success);
    }
    
    .note-box {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 10px;
      padding: 16px;
      margin-top: 20px;
      font-size: 18px;
      line-height: 1.5;
    }
    
    .note-title {
      font-weight: bold;
      margin-bottom: 8px;
      color: #856404;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .footer-note {
      text-align: center;
      margin-top: 30px;
      color: var(--gray);
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    /* responsive preview on page (scaled down) */
    #preview-wrap { 
      transform-origin: top left; 
      margin-bottom: 30px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }
    
    @media (max-width: 1200px) {
      #preview-wrap {
        width: 90%;
        overflow-x: auto;
      }
    }
  </style>
</head>
<body>

  <div class="header">
    <h1><i class="fab fa-tiktok"></i> TikTok Consultation Receipt</h1>
    <p>Buat struk konsultasi TikTok yang profesional dan menarik</p>
  </div>

  <div class="form-container">
    <h3><i class="fas fa-file-medical"></i> Form Konsultasi TikTok</h3>
    
    <div class="form-group">
      <label for="nama"><i class="fas fa-user"></i> Nama Pasien / Username</label>
      <input type="text" id="nama" placeholder="mis. dev_user">
    </div>
    
    <div class="form-group">
      <label for="kategori"><i class="fas fa-tags"></i> Kategori Akun</label>
      <input type="text" id="kategori" placeholder="mis. Edukasi, Hiburan, Gaming, dll.">
    </div>
    
    <div class="form-group">
      <label for="target"><i class="fas fa-bullseye"></i> Target Penonton</label>
      <input type="text" id="target" placeholder="mis. Remaja 15-20 tahun, Ibu-ibu, dll.">
    </div>
    
    <div class="form-group">
      <label for="skala"><i class="fas fa-chart-bar"></i> Skala Akun</label>
      <select id="skala">
        <option value="">Pilih Skala Akun</option>
        <option value="Mikro (<1K)">Mikro (&lt;1K)</option>
        <option value="Kecil (1K-10K)">Kecil (1K-10K)</option>
        <option value="Menengah (10K-100K)">Menengah (10K-100K)</option>
        <option value="Besar (100K-1M)">Besar (100K-1M)</option>
        <option value="Makro (>1M)">Makro (&gt;1M)</option>
      </select>
    </div>
    
    <div class="form-group">
      <label><i class="fas fa-star"></i> Penilaian Kualitas Konten</label>
      <div class="score-container">
        <div class="score-item">
          <span class="score-label">Kualitas Video</span>
          <div class="score-input">
            <input type="number" id="videoQuality" min="0" max="5" step="0.1" value="0">
            <span class="score-max">/ 5</span>
          </div>
        </div>
        
        <div class="score-item">
          <span class="score-label">Kualitas Audio</span>
          <div class="score-input">
            <input type="number" id="audioQuality" min="0" max="5" step="0.1" value="0">
            <span class="score-max">/ 5</span>
          </div>
        </div>
        
        <div class="score-item">
          <span class="score-label">Kreativitas Konten</span>
          <div class="score-input">
            <input type="number" id="creativity" min="0" max="5" step="0.1" value="0">
            <span class="score-max">/ 5</span>
          </div>
        </div>
        
        <div class="score-item">
          <span class="score-label">Nilai Manfaat</span>
          <div class="score-input">
            <input type="number" id="value" min="0" max="5" step="0.1" value="0">
            <span class="score-max">/ 5</span>
          </div>
        </div>
        
        <div class="score-item">
          <span class="score-label">Kualitas Engagement</span>
          <div class="score-input">
            <input type="number" id="engagement" min="0" max="5" step="0.1" value="0">
            <span class="score-max">/ 5</span>
          </div>
        </div>
        
        <div class="score-item">
          <span class="score-label">Konsistensi Konten</span>
          <div class="score-input">
            <input type="number" id="consistency" min="0" max="5" step="0.1" value="0">
            <span class="score-max">/ 5</span>
          </div>
        </div>
        
        <!-- Tambahan Skor Relevansi -->
        <div class="score-item">
          <span class="score-label">Relevansi Konten</span>
          <div class="score-input">
            <input type="number" id="relevance" min="0" max="5" step="0.1" value="0">
            <span class="score-max">/ 5</span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="form-group">
      <label for="potensiAktivitas"><i class="fas fa-running"></i> Potensi Aktivitas Akun</label>
      <textarea id="potensiAktivitas" placeholder="Aktivitas yang dilakukan di akun dan potensinya..."></textarea>
    </div>
    
    <div class="form-group">
      <label for="potensiSaatIni"><i class="fas fa-chart-line"></i> Potensi Saat Ini (Tanpa Perubahan)</label>
      <textarea id="potensiSaatIni" placeholder="Potensi akun jika tetap seperti sekarang..."></textarea>
    </div>
    
    <div class="form-group">
      <label for="potensiMasaDepan"><i class="fas fa-rocket"></i> Potensi Masa Depan (Dengan Saran)</label>
      <textarea id="potensiMasaDepan" placeholder="Potensi akun jika menerapkan saran..."></textarea>
    </div>
    
    <div class="form-group">
      <label for="keluhan"><i class="fas fa-comment-medical"></i> Keluhan</label>
      <textarea id="keluhan" placeholder="Keluhan (enter untuk baris baru)"></textarea>
    </div>
    
    <div class="form-group">
      <label for="diagnosis"><i class="fas fa-stethoscope"></i> Diagnosis</label>
      <textarea id="diagnosis" placeholder="Diagnosis (enter untuk baris baru)"></textarea>
    </div>
    
    <div class="form-group">
      <label for="saran"><i class="fas fa-lightbulb"></i> Saran-saran</label>
      <textarea id="saran" placeholder="Saran-saran (enter untuk baris baru)"></textarea>
    </div>
    
    <div class="form-group">
      <label for="biaya"><i class="fas fa-money-bill-wave"></i> Total Biaya</label>
      <input type="text" id="biaya" placeholder="mis. 150000">
    </div>
    
    <div class="buttons">
      <button class="btn-generate" onclick="generateReceipt()">
        <i class="fas fa-receipt"></i> Generate Struk
      </button>
      <button class="btn-download" onclick="downloadReceipt()">
        <i class="fas fa-download"></i> Download PNG
      </button>
    </div>
  </div>

  <!-- scaled preview (so it fits screen) -->
  <div id="preview-wrap" style="width:540px; overflow:auto;">
    <div id="result"></div>
  </div>

  <!-- html2canvas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    // escape html to avoid tags breaking layout
    function escapeHtml(str) {
      if (!str && str !== "") return "";
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    // Get score value
    function getScoreValue(inputId) {
      const input = document.getElementById(inputId);
      if (!input) return 0;
      
      const value = parseFloat(input.value);
      return isNaN(value) ? 0 : Math.min(5, Math.max(0, value));
    }

    // Generate score bar HTML
    function generateScoreBar(score) {
      const percentage = (score / 5) * 100;
      return `
        <div class="score-bar">
          <div class="score-fill" style="width: ${percentage}%"></div>
        </div>
      `;
    }

    function generateReceipt() {
      const namaRaw = document.getElementById('nama').value || '';
      const kategoriRaw = document.getElementById('kategori').value || '';
      const targetRaw = document.getElementById('target').value || '';
      const skalaRaw = document.getElementById('skala').value || '';
      const potensiAktivitasRaw = document.getElementById('potensiAktivitas').value || '';
      const potensiSaatIniRaw = document.getElementById('potensiSaatIni').value || '';
      const potensiMasaDepanRaw = document.getElementById('potensiMasaDepan').value || '';
      const keluhanRaw = document.getElementById('keluhan').value || '';
      const diagnosisRaw = document.getElementById('diagnosis').value || '';
      const saranRaw = document.getElementById('saran').value || '';
      const biayaRaw = document.getElementById('biaya').value || '0';
      
      // Get scores
      const videoQuality = getScoreValue('videoQuality');
      const audioQuality = getScoreValue('audioQuality');
      const creativity = getScoreValue('creativity');
      const value = getScoreValue('value');
      const engagement = getScoreValue('engagement');
      const consistency = getScoreValue('consistency');
      const relevance = getScoreValue('relevance');
      
      // Calculate average score
      const avgScore = (videoQuality + audioQuality + creativity + value + engagement + consistency + relevance) / 7;

      const nama = escapeHtml(namaRaw);
      const kategori = escapeHtml(kategoriRaw);
      const target = escapeHtml(targetRaw);
      const skala = escapeHtml(skalaRaw);
      const potensiAktivitas = escapeHtml(potensiAktivitasRaw);
      const potensiSaatIni = escapeHtml(potensiSaatIniRaw);
      const potensiMasaDepan = escapeHtml(potensiMasaDepanRaw);
      const keluhan = escapeHtml(keluhanRaw);
      const diagnosis = escapeHtml(diagnosisRaw);
      const saran = escapeHtml(saranRaw);
      const biaya = escapeHtml(biayaRaw);

      const tanggal = new Date().toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
      const jam = new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });

      const html = `
        <div class="receipt" id="receipt">
          <h2><i class="fab fa-tiktok"></i> HASIL KONSULTASI AKUN TIKTOK</h2>

          <div class="account-info">
            <div class="info-box">
              <div class="info-title">Kategori Akun</div>
              <div class="info-value">${kategori || '-'}</div>
            </div>
            <div class="info-box">
              <div class="info-title">Skala Akun</div>
              <div class="info-value">${skala || '-'}</div>
            </div>
          </div>

          <div class="section">
            <span class="label"><i class="fas fa-user"></i> Nama Pasien:</span>
            <div class="preserve">@${nama}</div>
          </div>

          <div class="section">
            <span class="label"><i class="fas fa-bullseye"></i> Target Penonton:</span>
            <div class="preserve">${target || '-'}</div>
          </div>

          <div class="section">
            <span class="label"><i class="fas fa-calendar-alt"></i> Tanggal / Jam:</span>
            <div class="preserve">${tanggal} | ${jam}</div>
          </div>

          <div class="section">
            <span class="label"><i class="fas fa-user-md"></i> Konsultan:</span>
            <div class="preserve">Dr. Novian (novdev)</div>
          </div>

          <hr>

          <div class="section">
            <span class="label"><i class="fas fa-analytics"></i> Analisis Potensi Akun:</span>
            <div class="potential-container">
              <div class="potential-item">
                <div class="potential-title"><i class="fas fa-running"></i> Potensi Aktivitas Akun</div>
                <div class="preserve">${potensiAktivitas || 'Tidak ada data'}</div>
              </div>
              <div class="potential-item">
                <div class="potential-title"><i class="fas fa-chart-line"></i> Potensi Saat Ini (Tanpa Perubahan)</div>
                <div class="preserve">${potensiSaatIni || 'Tidak ada data'}</div>
              </div>
              <div class="potential-item">
                <div class="potential-title"><i class="fas fa-rocket"></i> Potensi Masa Depan (Dengan Saran)</div>
                <div class="preserve">${potensiMasaDepan || 'Tidak ada data'}</div>
              </div>
            </div>
          </div>

          <div class="highlight-box">
            <div style="text-align:center; margin-bottom:15px; font-weight:bold; color:var(--primary); font-size:24px;">
              Skor Rata-rata: ${avgScore.toFixed(1)}/5
            </div>
            <div class="score-display">
              <div class="score-box">
                <div class="score-title">Kualitas Video</div>
                <div class="score-value">${videoQuality.toFixed(1)}/5</div>
                ${generateScoreBar(videoQuality)}
              </div>
              <div class="score-box">
                <div class="score-title">Kualitas Audio</div>
                <div class="score-value">${audioQuality.toFixed(1)}/5</div>
                ${generateScoreBar(audioQuality)}
              </div>
              <div class="score-box">
                <div class="score-title">Kreativitas</div>
                <div class="score-value">${creativity.toFixed(1)}/5</div>
                ${generateScoreBar(creativity)}
              </div>
              <div class="score-box">
                <div class="score-title">Nilai Manfaat</div>
                <div class="score-value">${value.toFixed(1)}/5</div>
                ${generateScoreBar(value)}
              </div>
              <div class="score-box">
                <div class="score-title">Kualitas Engagement</div>
                <div class="score-value">${engagement.toFixed(1)}/5</div>
                ${generateScoreBar(engagement)}
              </div>
              <div class="score-box">
                <div class="score-title">Konsistensi</div>
                <div class="score-value">${consistency.toFixed(1)}/5</div>
                ${generateScoreBar(consistency)}
              </div>
              <div class="score-box">
                <div class="score-title">Relevansi</div>
                <div class="score-value">${relevance.toFixed(1)}/5</div>
                ${generateScoreBar(relevance)}
              </div>
            </div>
          </div>

          <div class="section">
            <span class="label"><i class="fas fa-comment-medical"></i> Keluhan:</span>
            <div class="preserve">${keluhan || 'Tidak ada keluhan'}</div>
          </div>

          <div class="section">
            <span class="label"><i class="fas fa-stethoscope"></i> Diagnosis:</span>
            <div class="preserve">${diagnosis || 'Tidak ada diagnosis'}</div>
          </div>

          <div class="section">
            <span class="label"><i class="fas fa-lightbulb"></i> Saran:</span>
            <div class="preserve">${saran || 'Tidak ada saran'}</div>
          </div>

          <hr>

          <div class="section">
            <span class="label"><i class="fas fa-money-bill-wave"></i> Total Biaya:</span>
            <div class="preserve" style="font-size:24px; font-weight:bold; color:var(--primary);">Rp ${biaya}</div>
          </div>

          <div class="note-box">
            <div class="note-title"><i class="fas fa-exclamation-circle"></i> Catatan Penting:</div>
            <div class="preserve" style="font-size:18px;">
Setelah menerapkan saran dari konsultasi ini, akun TikTok Anda mungkin mengalami fluktuasi dalam hal engagement. Jika eksekusi dilakukan dengan benar dan konsisten, potensi peningkatan engagement sangat besar. Namun, wajar jika di awal penerapan perubahan, akun mengalami penurunan sementara karena algoritma TikTok sedang menyesuaikan dengan konten baru Anda.

Jangan khawatir jika terjadi penurunan, karena ini adalah bagian dari proses adaptasi. Teruslah belajar dari kesalahan sebelumnya, analisis performa konten, dan terapkan strategi terbaik berdasarkan data yang Anda kumpulkan. Konsistensi dan evaluasi berkelanjutan adalah kunci kesuksesan di platform TikTok.
            </div>
          </div>

          <div class="footer-note">
            <i class="fas fa-heart"></i> Terima kasih sudah konsultasi!
          </div>
        </div>
      `;

      document.getElementById('result').innerHTML = html;

      // scale preview down so it fits page (optional)
      // preview-wrap width is 540 so scale 0.5
      const previewWrap = document.getElementById('preview-wrap');
      const receiptEl = document.getElementById('receipt');
      if (receiptEl) {
        // reset transform then set scale
        receiptEl.style.transform = 'scale(0.5)';
        receiptEl.style.transformOrigin = 'top left';
      }
    }

    async function downloadReceipt() {
      const receipt = document.getElementById('receipt');
      if (!receipt) {
        alert('Generate struk dulu sebelum download.');
        return;
      }

      // remove scale for high-res rendering: clone and render off-DOM
      const clone = receipt.cloneNode(true);
      // reset any transform on clone
      clone.style.transform = '';
      clone.style.transformOrigin = '';

      // place clone in an offscreen container
      const off = document.createElement('div');
      off.style.position = 'fixed';
      off.style.left = '-9999px';
      off.style.top = '0';
      off.appendChild(clone);
      document.body.appendChild(off);

      // render with html2canvas: width fixed 1080, scale 2 for crisp
      const canvas = await html2canvas(clone, {
        width: clone.scrollWidth,
        height: clone.scrollHeight,
        scale: 2,
        useCORS: true,
        backgroundColor: '#ffffff'
      });

      // cleanup
      document.body.removeChild(off);

      // download
      const link = document.createElement('a');
      link.download = `Struk-Konsultasi-${Date.now()}.png`;
      link.href = canvas.toDataURL('image/png');
      link.click();
    }
  </script>
</body>
</html>
